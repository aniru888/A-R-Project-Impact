<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calculate environmental impact of afforestation and water conservation projects with customizable parameters">
    <title>A/R Project Impact Calculator</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒ²</text></svg>">
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Main app entry point -->
    <script type="module" src="main.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1 class="app-title">A/R Project Impact Calculator</h1>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- Project Tabs -->
            <div class="tabs-container">
                <ul class="tabs">
                    <li>
                        <button class="project-tab active" data-project="forest">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 14v6m-3-3h6M7 4v16M3 8h8M19 4v4M15 4h8"></path></svg>
                            Afforestation/Reforestation
                        </button>
                    </li>
                    <li>
                        <button class="project-tab" data-project="water">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"></path></svg>
                            Water Body Restoration
                        </button>
                    </li>
                </ul>
            </div>

            <!-- Forest Project Content -->
            <div class="project-content active" id="forestProjectContent" data-project="forest">
                <div class="content-grid">
                    <!-- Forest Form Column -->
                    <div class="form-column">
                        <div class="card">
                            <h2>Project Details & Parameters</h2>
                            
                            <form id="calculatorForm">
                                <!-- File Upload Section -->
                                <div class="form-section">
                                    <h3>Species Data Upload (Optional)</h3>
                                    <p class="text-sm text-gray-500 mb-4">Upload an Excel (.xlsx, .xls) or CSV (.csv) file with species details. This will override individual species parameters below.</p>
                                    
                                    <div class="file-upload">
                                        <div class="file-upload-content">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/><path d="M14 3v5h5M12 18v-6M9 15h6"/></svg>
                                            <input type="file" id="speciesFile" accept=".xlsx, .xls, .csv">
                                            <p class="text-sm">Drag & drop files here or <span class="text-primary">browse</span></p>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4 flex justify-end">
                                        <button type="button" id="downloadTemplateBtn" class="btn btn-outline">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"></path></svg>
                                            Download Template
                                        </button>
                                    </div>
                                    
                                    <div id="speciesList" class="mt-4 text-sm text-gray-500"></div>
                                </div>
                                
                                <!-- Basic Parameters -->
                                <div class="form-section">
                                    <h3>Basic Parameters</h3>
                                    <div class="form-group">
                                        <label for="projectLocation" class="label">Project Location</label>
                                        <input type="text" id="projectLocation" name="projectLocation" class="input" placeholder="e.g., Shimla, Himachal Pradesh">
                                    </div>
                                    <div class="form-group">
                                        <label for="organizationName" class="label">Organization / Company Name</label>
                                        <input type="text" id="organizationName" name="organizationName" class="input" placeholder="e.g., Green Forest Initiative">
                                    </div>
                                    <div class="grid-1-3">
                                        <div class="form-group">
                                            <label for="projectDuration" class="label">Project Duration (Years)</label>
                                            <input type="number" id="projectDuration" name="projectDuration" class="input" value="20" min="1" max="100" required>
                                            <p class="input-feedback" id="projectDuration-feedback"></p>
                                        </div>
                                        <div class="form-group">
                                            <label for="projectArea" class="label">Project Area (Hectares)</label>
                                            <input type="number" id="projectArea" name="projectArea" class="input" value="10" min="0.1" step="0.1" required>
                                            <p class="input-feedback" id="projectArea-feedback"></p>
                                        </div>
                                        <div class="form-group">
                                            <label for="plantingDensity" class="label">Planting Density (Trees/Ha)</label>
                                            <input type="number" id="plantingDensity" name="plantingDensity" class="input" value="1600" min="100" max="10000">
                                            <p class="input-feedback" id="plantingDensity-feedback"></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Conversion Factors -->
                                <div class="form-section">
                                    <h3>Conversion Factors</h3>
                                    <p class="text-sm text-gray-500 mb-4">Default values provided, override if needed for your specific project context.</p>
                                    
                                    <div class="grid-1-2">
                                        <div class="form-group">
                                            <label for="growthRate" class="label">Growth Rate (mÂ³/ha/yr)</label>
                                            <div class="input-group">
                                                <input type="number" id="growthRate" name="growthRate" class="input" value="10" min="1" max="50" step="0.1" data-default="10">
                                                <button type="button" class="reset-btn" data-for="growthRate" title="Reset to default">â†º</button>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="woodDensity" class="label">Wood Density (tdm/mÂ³)</label>
                                            <div class="input-group">
                                                <input type="number" id="woodDensity" name="woodDensity" class="input" value="0.5" min="0.1" max="1.5" step="0.01" data-default="0.5">
                                                <button type="button" class="reset-btn" data-for="woodDensity" title="Reset to default">â†º</button>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="bef" class="label">Biomass Expansion Factor</label>
                                            <div class="input-group">
                                                <input type="number" id="bef" name="bef" class="input" value="1.5" min="1.0" max="3.0" step="0.01" data-default="1.5">
                                                <button type="button" class="reset-btn" data-for="bef" title="Reset to default">â†º</button>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="rsr" class="label">Root-Shoot Ratio (RSR)</label>
                                            <div class="input-group">
                                                <input type="number" id="rsr" name="rsr" class="input" value="0.25" min="0.1" max="0.8" step="0.01" data-default="0.25">
                                                <button type="button" class="reset-btn" data-for="rsr" title="Reset to default">â†º</button>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="carbonFraction" class="label">Carbon Fraction</label>
                                            <div class="input-group">
                                                <input type="number" id="carbonFraction" name="carbonFraction" class="input" value="0.47" min="0.4" max="0.6" step="0.01" data-default="0.47">
                                                <button type="button" class="reset-btn" data-for="carbonFraction" title="Reset to default">â†º</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Site Factors -->
                                <div class="form-section">
                                    <h3>Site Factors</h3>
                                    <div class="grid-1-3">
                                        <div class="form-group">
                                            <label for="siteQuality" class="label">Site Quality</label>
                                            <select id="siteQuality" name="siteQuality" class="input">
                                                <option value="Medium">Medium</option>
                                                <option value="Good">Good</option>
                                                <option value="Poor">Poor</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="avgRainfall" class="label">Average Rainfall</label>
                                            <select id="avgRainfall" name="avgRainfall" class="input">
                                                <option value="Medium">Medium</option>
                                                <option value="High">High</option>
                                                <option value="Low">Low</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="soilType" class="label">Soil Type</label>
                                            <select id="soilType" name="soilType" class="input">
                                                <option value="Loam">Loam</option>
                                                <option value="Sandy">Sandy</option>
                                                <option value="Clay">Clay</option>
                                                <option value="Degraded">Degraded</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="survivalRate" class="label">Survival Rate (%)</label>
                                            <input type="number" id="survivalRate" name="survivalRate" class="input" value="85" min="50" max="100">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Enhanced Features -->
                                <div class="form-section">
                                    <h3>Enhanced Features & Adjustments</h3>
                                    <div class="grid-1-2">
                                        <!-- Green Cover Analysis -->
                                        <div>
                                            <h4>Green Cover Analysis</h4>
                                            <div class="form-group">
                                                <label for="initialGreenCover" class="label">Initial Green Cover (Hectares)</label>
                                                <input type="number" id="initialGreenCover" name="initialGreenCover" class="input" value="0" min="0" step="0.1">
                                            </div>
                                            <div class="form-group">
                                                <label for="totalGeographicalArea" class="label">Total Geographical Area (Hectares)</label>
                                                <input type="number" id="totalGeographicalArea" name="totalGeographicalArea" class="input" value="100" min="0.1" step="0.1">
                                            </div>
                                        </div>
                                        
                                        <!-- Carbon Credits & Risk -->
                                        <div>
                                            <h4>Carbon Credits & Risk</h4>
                                            <div class="form-group">
                                                <label for="carbonPriceSelect" class="label">Carbon Price ($/tCOâ‚‚e)</label>
                                                <select id="carbonPriceSelect" name="carbonPriceSelect" class="input">
                                                    <option value="10">$10 (Typical Voluntary Market)</option>
                                                    <option value="25">$25</option>
                                                    <option value="50">$50 (Higher Quality Projects)</option>
                                                    <option value="custom">Custom</option>
                                                </select>
                                            </div>
                                            <div id="customCarbonPriceContainer" class="form-group hidden">
                                                <label for="customCarbonPrice" class="label">Custom Carbon Price ($/tCOâ‚‚e)</label>
                                                <input type="number" id="customCarbonPrice" name="customCarbonPrice" class="input" min="0" step="0.01">
                                            </div>
                                            <div class="form-group">
                                                <label for="riskRate" class="label">Risk Buffer Pool (%)</label>
                                                <input type="number" id="riskRate" name="riskRate" class="input" value="15" min="0" max="100">
                                                <p class="text-sm text-gray-500 mt-2">Percentage deducted for risks like fire, disease, etc.</p>
                                            </div>
                                            <div class="form-group">
                                                <label for="deadAttribute" class="label">Non-Additionality / Dead Attribute (%)</label>
                                                <input type="number" id="deadAttribute" name="deadAttribute" class="input" value="0" min="0" max="100" step="1">
                                                <p class="text-sm text-gray-500 mt-2">Sequestration that might have occurred anyway (e.g., natural regeneration).</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Cost Analysis Input -->
                                <div class="form-section">
                                    <h3>Cost Analysis (Optional)</h3>
                                    <div class="form-group">
                                        <label for="forestProjectCost" class="label">Total Estimated Project Cost (INR)</label>
                                        <input type="number" id="forestProjectCost" name="forestProjectCost" class="input" placeholder="e.g., 500000" min="0">
                                        <p class="text-sm text-gray-500 mt-2">Enter the total cost for the entire project duration.</p>
                                    </div>
                                </div>
                                
                                <!-- Error Messages -->
                                <div id="errorMessageForest" class="error-message hidden"></div>
                                
                                <!-- Action Buttons -->
                                <div class="btn-group mt-4 justify-end">
                                    <button type="button" id="resetForestBtn" class="btn btn-outline">Reset Form</button>
                                    <button type="button" id="calculateForestBtn" class="btn btn-primary">Calculate Net Sequestration</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Forest Results Column -->
                    <div class="results-column">
                        <div id="resultsSectionForest" class="card hidden">
                            <div class="flex justify-between items-center mb-4">
                                <h2>Estimated Net Sequestration Results</h2>
                                <div class="btn-group">
                                    <button type="button" id="exportForestExcelBtn" class="btn btn-outline">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/><path d="M14 3v5h5M16 13H8M16 17H8M10 9H8"/></svg>
                                        Export Excel
                                    </button>
                                    <button type="button" id="generateForestPdfBtn" class="btn btn-outline">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/><path d="M14 3v5h5M16 13H8M16 17H8M10 9H8"/></svg>
                                        Generate PDF
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Summary Metrics -->
                            <div class="metrics-grid">
                                <div class="metric-card">
                                    <h4 class="metric-title">Total Net COâ‚‚e Sequestered</h4>
                                    <div class="metric-value" id="totalNetCO2e">--</div>
                                    <div class="metric-unit">tCOâ‚‚e</div>
                                </div>
                                <div class="metric-card">
                                    <h4 class="metric-title">Total VERs (After Risk/Dead Attribute)</h4>
                                    <div class="metric-value" id="totalVERs">--</div>
                                    <div class="metric-unit">VERs</div>
                                </div>
                                <div class="metric-card">
                                    <h4 class="metric-title">Estimated Revenue</h4>
                                    <div class="metric-value" id="estimatedRevenue">--</div>
                                    <div class="metric-unit">USD</div>
                                </div>
                                <div class="metric-card">
                                    <h4 class="metric-title">Ecosystem Maturity</h4>
                                    <div class="metric-value" id="ecosystemMaturity">--</div>
                                    <div class="metric-unit">% of Peak MAI Age</div>
                                </div>
                            </div>
                            
                            <!-- Green Cover Impact -->
                            <div class="card mb-4">
                                <h3>Green Cover Impact</h3>
                                <div class="grid-1-3">
                                    <div class="text-center">
                                        <p class="text-gray-500 mb-2">Initial Green Cover</p>
                                        <p id="initialGreenCoverPercentage" class="metric-value">0%</p>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-gray-500 mb-2">Final Green Cover</p>
                                        <p id="finalGreenCoverPercentage" class="metric-value">0%</p>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-gray-500 mb-2">Absolute Increase</p>
                                        <p id="absoluteGreenCoverIncrease" class="metric-value">0 ha</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Cost Analysis Results -->
                            <div id="costAnalysisResults" class="card mb-4">
                                <h3>Cost Analysis Results</h3>
                                <div class="metrics-grid">
                                    <div class="metric-card">
                                        <h4 class="metric-title">Total Sequestration</h4>
                                        <div class="metric-value" id="totalSequestrationCostDisplay">--</div>
                                        <div class="metric-unit">tCOâ‚‚e</div>
                                    </div>
                                    <div class="metric-card">
                                        <h4 class="metric-title">Total Project Cost</h4>
                                        <div class="metric-value" id="totalProjectCostDisplay">--</div>
                                        <div class="metric-unit">INR</div>
                                    </div>
                                    <div class="metric-card">
                                        <h4 class="metric-title">Cost per Tonne COâ‚‚e</h4>
                                        <div class="metric-value" id="costPerTonneDisplay">--</div>
                                        <div class="metric-unit">INR/tCOâ‚‚e</div>
                                    </div>
                                    <div class="metric-card">
                                        <h4 class="metric-title">Cost per Ha per Tonne COâ‚‚e</h4>
                                        <div class="metric-value" id="costPerHectarePerTonneDisplay">--</div>
                                        <div class="metric-unit">INR/ha/tCOâ‚‚e</div>
                                    </div>
                                </div>
                                <div id="costBreakdown" class="mt-4 text-sm text-gray-500"></div>
                            </div>
                            
                            <!-- Chart -->
                            <h3>Sequestration Over Time</h3>
                            <div class="chart-container mb-4">
                                <canvas id="sequestrationChart"></canvas>
                            </div>
                            
                            <!-- Detailed Results Table -->
                            <h3>Annual Sequestration Details</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Year</th>
                                            <th>Stand Age</th>
                                            <th>Est. Gross Stem Vol. Incr. (mÂ³/ha/yr)</th>
                                            <th>Net Annual COâ‚‚e Seq. (tCOâ‚‚e/yr)</th>
                                            <th>Cumulative Net COâ‚‚e Seq. (tCOâ‚‚e)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="resultsBodyForest">
                                        <!-- Results rows will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Water Project Content -->
            <div class="project-content hidden" id="waterProjectContent" data-project="water">
                <div class="content-grid">
                    <!-- Water Form Column -->
                    <div class="form-column">
                        <div class="card">
                            <h2>Water Project Details</h2>
                            
                            <form id="waterCalculatorForm">
                                <!-- Error Messages -->
                                <div id="errorMessageWater" class="error-message hidden"></div>
                                
                                <!-- Water Project Basic Details -->
                                <div class="form-section">
                                    <h3>Project Details</h3>
                                    <div class="form-group">
                                        <label for="waterProjectLocation" class="label">Project Location</label>
                                        <input type="text" id="waterProjectLocation" class="input" placeholder="e.g., Bangalore, Karnataka">
                                    </div>
                                    
                                    <div class="grid-1-2">
                                        <div class="form-group">
                                            <label for="waterProjectArea" class="label">Catchment Area (hectares)</label>
                                            <input type="number" id="waterProjectArea" class="input" placeholder="e.g., 100" min="0.1" step="0.1" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="waterProjectDuration" class="label">Project Lifespan (years)</label>
                                            <input type="number" id="waterProjectDuration" class="input" placeholder="e.g., 20" min="1" max="50" value="20" required>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="waterProjectType" class="label">Project Type</label>
                                        <select id="waterProjectType" class="input" required>
                                            <option value="">Select project type</option>
                                            <option value="rainwater_harvesting">Rainwater Harvesting (Surface Storage)</option>
                                            <option value="watershed_management">Watershed Management (Check Dams, etc.)</option>
                                            <option value="groundwater_recharge">Groundwater Recharge (Recharge Pits, Wells)</option>
                                            <option value="water_conservation">Water Conservation (Efficiency Measures)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Water Parameters -->
                                <div class="form-section">
                                    <h3>Water Parameters</h3>
                                    <div class="grid-1-2">
                                        <div class="form-group">
                                            <label for="annualRainfall" class="label">Annual Rainfall (mm)</label>
                                            <input type="number" id="annualRainfall" class="input" placeholder="e.g., 800" min="0" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="runoffCoefficient" class="label">Runoff Coefficient</label>
                                            <div class="input-group">
                                                <input type="number" id="runoffCoefficient" class="input" placeholder="e.g., 0.6" min="0" max="1" step="0.01" value="0.6" data-default="0.6" required>
                                                <button type="button" class="reset-btn" data-for="runoffCoefficient" title="Reset to default">â†º</button>
                                            </div>
                                            <p class="text-sm text-gray-500 mt-2">Fraction of rainfall becoming runoff (0-1)</p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid-1-2">
                                        <div class="form-group">
                                            <label for="captureEfficiency" class="label">Capture/Recharge Efficiency (%)</label>
                                            <div class="input-group">
                                                <input type="number" id="captureEfficiency" class="input" placeholder="e.g., 75" min="1" max="100" value="75" data-default="75" required>
                                                <button type="button" class="reset-btn" data-for="captureEfficiency" title="Reset to default">â†º</button>
                                            </div>
                                            <p class="text-sm text-gray-500 mt-2">System efficiency (1-100%)</p>
                                        </div>
                                        <div class="form-group">
                                            <label for="energySavings" class="label">Energy Savings Factor (kWh/kL)</label>
                                            <div class="input-group">
                                                <input type="number" id="energySavings" class="input" placeholder="e.g., 0.5" min="0" step="0.01" value="0.5" data-default="0.5" required>
                                                <button type="button" class="reset-btn" data-for="energySavings" title="Reset to default">â†º</button>
                                            </div>
                                            <p class="text-sm text-gray-500 mt-2">Energy saved per kiloliter</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Additional Water Information -->
                                <div class="form-section">
                                    <h3>Additional Information (Optional)</h3>
                                    <div class="grid-1-2">
                                        <div class="form-group">
                                            <label for="waterDemand" class="label">Annual Water Demand Met (kiloliters/yr)</label>
                                            <input type="number" id="waterDemand" class="input" placeholder="e.g., 5000" min="0">
                                            <p class="text-sm text-gray-500 mt-2">Estimated demand this project helps meet</p>
                                        </div>
                                        <div class="form-group">
                                            <label for="waterProjectCost" class="label">Total Project Cost (â‚¹)</label>
                                            <input type="text" id="waterProjectCost" class="input" placeholder="e.g., 10,00,000">
                                            <p class="text-sm text-gray-500 mt-2">Estimated total cost over project lifespan</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="btn-group mt-4 justify-end">
                                    <button type="button" id="resetWaterBtn" class="btn btn-outline">Reset Form</button>
                                    <button type="button" id="calculateWaterBtn" class="btn btn-primary">
                                        <span id="btnSpinnerWater" class="spinner hidden"></span>
                                        <span id="waterBtnText">Calculate Water Impact</span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Water Results Column -->
                    <div class="results-column">
                        <div id="resultsSectionWater" class="card hidden">
                            <div class="flex justify-between items-center mb-4">
                                <h2>Water Project Impact Results</h2>
                                <div class="btn-group">
                                    <button type="button" id="exportWaterExcelBtn" class="btn btn-outline">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/><path d="M14 3v5h5M16 13H8M16 17H8M10 9H8"/></svg>
                                        Export Excel
                                    </button>
                                    <button type="button" id="generateWaterPdfBtn" class="btn btn-outline">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/><path d="M14 3v5h5M16 13H8M16 17H8M10 9H8"/></svg>
                                        Generate PDF
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Summary Metrics -->
                            <div class="metrics-grid">
                                <div class="metric-card">
                                    <h4 class="metric-title">Total Water Harvested</h4>
                                    <div class="metric-value" id="totalWaterCaptured">--</div>
                                    <div class="metric-unit">kL</div>
                                </div>
                                <div class="metric-card">
                                    <h4 class="metric-title">Annual Water Harvested</h4>
                                    <div class="metric-value" id="annualWaterCaptured">--</div>
                                    <div class="metric-unit">kL/year</div>
                                </div>
                                <div class="metric-card">
                                    <h4 class="metric-title">Emissions Reduction</h4>
                                    <div class="metric-value" id="emissionsReduction">--</div>
                                    <div class="metric-unit">kg COâ‚‚e</div>
                                </div>
                                <div class="metric-card">
                                    <h4 class="metric-title">Demand Coverage</h4>
                                    <div class="metric-value" id="demandCoverage">--</div>
                                    <div class="metric-unit">%</div>
                                </div>
                            </div>
                            
                            <!-- Cost Analysis -->
                            <div class="card mb-4">
                                <h3>Cost Analysis</h3>
                                <div class="metrics-grid">
                                    <div class="metric-card">
                                        <h4 class="metric-title">Total Project Cost</h4>
                                        <div class="metric-value" id="waterTotalProjectCost">--</div>
                                        <div class="metric-unit">â‚¹</div>
                                    </div>
                                    <div class="metric-card">
                                        <h4 class="metric-title">Cost per Kiloliter</h4>
                                        <div class="metric-value" id="costPerKiloliter">--</div>
                                        <div class="metric-unit">â‚¹/kL</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-value" id="costPerKiloliter">--</div>
                                        <div class="metric-unit">â‚¹/kL</div>
                                    </div>
                                    <div class="metric-card">
                                        <h4 class="metric-title">Cost per Hectare</h4>
                                        <div class="metric-value" id="costPerHectare">--</div>
                                        <div class="metric-unit">â‚¹/ha</div>
                                    </div>
                                    <div class="metric-card">
                                        <h4 class="metric-title">Payback Period</h4>
                                        <div class="metric-value" id="paybackPeriod">--</div>
                                        <div class="metric-unit">years</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Chart -->
                            <h3>Water Capture Over Time</h3>
                            <div class="chart-container mb-4">
                                <canvas id="waterCaptureChart"></canvas>
                            </div>
                            
                            <!-- Detailed Results Table -->
                            <h3>Yearly Water Capture Details</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Year</th>
                                            <th>Water Captured (kL/yr)</th>
                                            <th>Cumulative Water (kL)</th>
                                            <th>Energy Saved (kWh)</th>
                                            <th>Emissions Reduced (kg COâ‚‚e)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="waterResultsBody">
                                        <!-- Results rows will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>Â© 2024 A&R Impact Estimator. All rights reserved.</p>
        </div>
    </footer>

    <!-- Dark mode toggle -->
    <button id="darkModeToggle" class="dark-toggle" aria-label="Toggle dark mode">ðŸŒ™</button>
    
    <!-- Backup event listener script -->
    <script>
        // This script ensures buttons have click listeners even if the main app fails to initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a short time to allow the main JS to initialize first
            setTimeout(function() {
                // Forest calculator buttons
                const calculateForestBtn = document.getElementById('calculateForestBtn');
                const resetForestBtn = document.getElementById('resetForestBtn');
                const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');
                const exportForestExcelBtn = document.getElementById('exportForestExcelBtn');
                const generateForestPdfBtn = document.getElementById('generateForestPdfBtn');
                
                // Add download template functionality
                if (downloadTemplateBtn && !downloadTemplateBtn._hasClickListener) {
                    downloadTemplateBtn._hasClickListener = true;
                    downloadTemplateBtn.addEventListener('click', function(event) {
                        event.preventDefault();
                        console.log('Download template button clicked via backup handler');
                        
                        // Visual feedback
                        const originalText = downloadTemplateBtn.textContent.trim();
                        const svgIcon = downloadTemplateBtn.querySelector('svg');
                        if (svgIcon) svgIcon.style.display = 'none'; // Hide icon during download
                        downloadTemplateBtn.disabled = true;
                        downloadTemplateBtn.textContent = 'Downloading...';
                        
                        try {
                            // Try to call the downloadExcelTemplate function from forestIO if available
                            if (window.forestIO && typeof window.forestIO.downloadExcelTemplate === 'function') {
                                window.forestIO.downloadExcelTemplate();
                            } else {
                                // Fallback implementation if the main function is not available
                                console.log("Main downloadExcelTemplate not available, using fallback");
                                
                                // Create a simple CSV template as fallback
                                let csvContent = 'Species Name,Number of Trees,Growth Rate (mÂ³/ha/yr),Wood Density (tdm/mÂ³),BEF,Root-Shoot Ratio,Carbon Fraction,Site Quality,Average Rainfall,Soil Type,Survival Rate (%)\n';
                                csvContent += 'Tectona grandis (Teak),500,12,0.65,1.5,0.27,0.47,Good,Medium,Loam,90\n';
                                csvContent += 'Eucalyptus globulus,1000,25,0.55,1.3,0.24,0.47,Medium,High,Sandy,85\n';
                                
                                // Create a download link and trigger it
                                const blob = new Blob([csvContent], { type: 'text/csv' });
                                const url = window.URL.createObjectURL(blob);
                                const a = document.createElement('a');
                                a.setAttribute('hidden', '');
                                a.setAttribute('href', url);
                                a.setAttribute('download', 'species-template.csv');
                                document.body.appendChild(a);
                                a.click();
                                document.body.removeChild(a);
                                window.URL.revokeObjectURL(url);
                            }
                        } catch (e) {
                            console.error("Error downloading template:", e);
                            alert("Error creating template. Please check console for details.");
                        }
                        
                        // Reset button text after a short delay
                        setTimeout(() => {
                            if (svgIcon) {
                                downloadTemplateBtn.textContent = '';
                                downloadTemplateBtn.appendChild(svgIcon);
                                svgIcon.style.display = ''; // Make icon visible again
                                downloadTemplateBtn.appendChild(document.createTextNode(originalText));
                            } else {
                                downloadTemplateBtn.textContent = originalText;
                            }
                            downloadTemplateBtn.disabled = false;
                        }, 2000);
                    });
                }
                
                // Add click listeners to buttons if they don't already have them
                if (calculateForestBtn && !calculateForestBtn._hasClickListener) {
                    calculateForestBtn._hasClickListener = true;
                    calculateForestBtn.addEventListener('click', function(event) {
                        console.log('Forest calculate button clicked via backup handler');
                        event.preventDefault();
                        
                        // Try to call the handler from forestMain if available
                        if (window.forestCalculator && typeof window.forestCalculator.handleForestFormSubmit === 'function') {
                            window.forestCalculator.handleForestFormSubmit(event);
                        } else {
                            console.warn('Forest calculator not properly initialized, using backup handler');
                            // Simple form validation
                            const errorDiv = document.getElementById('errorMessageForest');
                            if (errorDiv) {
                                errorDiv.textContent = '';
                                errorDiv.classList.add('hidden');
                            }
                            
                            // Show results section
                            const resultsSection = document.getElementById('resultsSectionForest');
                            if (resultsSection) {
                                resultsSection.classList.remove('hidden');
                                resultsSection.scrollIntoView({ behavior: 'smooth' });
                            }
                        }
                    });
                }
                
                if (resetForestBtn && !resetForestBtn._hasClickListener) {
                    resetForestBtn._hasClickListener = true;
                    resetForestBtn.addEventListener('click', function() {
                        console.log('Forest reset button clicked via backup handler');
                        // Reset form
                        const form = document.getElementById('calculatorForm');
                        if (form) form.reset();
                        
                        // Hide results
                        const resultsSection = document.getElementById('resultsSectionForest');
                        if (resultsSection) resultsSection.classList.add('hidden');
                        
                        // Clear error message
                        const errorDiv = document.getElementById('errorMessageForest');
                        if (errorDiv) {
                            errorDiv.textContent = '';
                            errorDiv.classList.add('hidden');
                        }
                    });
                }
                
                // Handle project tabs
                const projectTabs = document.querySelectorAll('.project-tab');
                projectTabs.forEach(tab => {
                    if (!tab._hasClickListener) {
                        tab._hasClickListener = true;
                        tab.addEventListener('click', function() {
                            const targetProject = tab.getAttribute('data-project');
                            
                            // Update tab buttons state
                            projectTabs.forEach(t => t.classList.remove('active'));
                            tab.classList.add('active');
                            
                            // Update content visibility
                            const projectContents = document.querySelectorAll('.project-content');
                            projectContents.forEach(content => {
                                if (content.getAttribute('data-project') === targetProject) {
                                    content.classList.remove('hidden');
                                    content.classList.add('active');
                                } else {
                                    content.classList.add('hidden');
                                    content.classList.remove('active');
                                }
                            });
                        });
                    }
                });
                
                // Similar handlers for water calculator buttons
                const calculateWaterBtn = document.getElementById('calculateWaterBtn');
                const resetWaterBtn = document.getElementById('resetWaterBtn');
                const exportWaterExcelBtn = document.getElementById('exportWaterExcelBtn');
                const generateWaterPdfBtn = document.getElementById('generateWaterPdfBtn');
                
                if (calculateWaterBtn && !calculateWaterBtn._hasClickListener) {
                    calculateWaterBtn._hasClickListener = true;
                    calculateWaterBtn.addEventListener('click', function(event) {
                        console.log('Water calculate button clicked via backup handler');
                        event.preventDefault();
                        
                        // Show water results section
                        const resultsSection = document.getElementById('resultsSectionWater');
                        if (resultsSection) {
                            resultsSection.classList.remove('hidden');
                            resultsSection.scrollIntoView({ behavior: 'smooth' });
                        }
                    });
                }
                
                if (resetWaterBtn && !resetWaterBtn._hasClickListener) {
                    resetWaterBtn._hasClickListener = true;
                    resetWaterBtn.addEventListener('click', function() {
                        console.log('Water reset button clicked via backup handler');
                        // Reset form
                        const form = document.getElementById('waterCalculatorForm');
                        if (form) form.reset();
                        
                        // Hide results
                        const resultsSection = document.getElementById('resultsSectionWater');
                        if (resultsSection) resultsSection.classList.add('hidden');
                    });
                }
                
                console.log('Backup event listeners installed for buttons');
            }, 1000); // Give the main app 1 second to initialize first
        });
    </script>
</body>
</html>